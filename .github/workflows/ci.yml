name: CI - Build and Test

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  build_and_test:
    runs-on: ubuntu-latest

    steps:
      # 1. Repository'i çekme
      - uses: actions/checkout@v2

      # 2. Docker kullanarak uygulamayı başlatma (Frontend ve Backend)
      - name: Start Backend container
        run: |
          docker run -d --name backend-app -p 5000:5000 your-backend-image

      - name: Start Frontend container
        run: |
          docker run -d --name frontend-app -p 3000:3000 your-frontend-image

      # 3. Uygulamanın hazır olmasını bekleme
      - name: Wait for the frontend to be ready
        run: |
          while ! curl --silent --fail http://localhost:3000; do
            echo "Waiting for frontend to start..."
            sleep 10
          done
          echo "Frontend is ready!"

      - name: Wait for the backend to be ready
        run: |
          while ! curl --silent --fail http://localhost:5000; do
            echo "Waiting for backend to start..."
            sleep 10
          done
          echo "Backend is ready!"

      # 4. Test framework'ünüzü çalıştırma
      - name: Run Selenium and Cucumber Tests
        run: mvn clean verify  # Maven komutunu testlerinizi çalıştırmak için kullanın

      # # 5. Test sonuçlarını yükleme (Opsiyonel)
      # - name: Upload test results as artifact
      #   uses: actions/upload-artifact@v2
      #   with:
      #     name: selenium-test-results
      #     path: target/cucumber-html-reports/overview-features.html  # Test raporlarının bulunduğu yer

