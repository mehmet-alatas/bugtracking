name: CI - Build and Test

on:
  push:
    branches:
      - main  # Ana branch'e yapılan push işlemi
  pull_request:
    branches:
      - main  # Ana branch'e yapılan pull request işlemleri

jobs:
  # Frontend Build ve Test
  frontend:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout Repository
      uses: actions/checkout@v2

    - name: Set up Node.js for React
      uses: actions/setup-node@v2
      with:
        node-version: '14'

    - name: Install Dependencies for Frontend
      run: |
        cd frontend
        npm install  # React frontend bağımlılıklarını kur

    - name: Build React App
      run: |
        cd frontend
        CI=false npm run build  # React frontend uygulamasını build et

  # Backend Build ve Test
  backend:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout Repository
      uses: actions/checkout@v2

    - name: Set up Node.js for Backend
      uses: actions/setup-node@v2
      with:
        node-version: '14'

    - name: Install Dependencies for Backend
      run: |
        cd backend
        npm install  # Node.js backend bağımlılıklarını kur

    - name: Run Backend Tests
      run: |
        cd backend
        npm test  # Node.js backend testlerini çalıştır

  # Test Framework'ü (Selenium, Cucumber, Java testleri) Çalıştırma
  test:
    runs-on: ubuntu-latest

    steps:
    # 1. Test framework'ünüzün bulunduğu repository'yi çekme
    - name: Checkout Test Framework Repository
      uses: actions/checkout@v2
      with:
        repository: 'mehmet-alatas/testframework'  # Test framework repo URL'si
        token: ${{ secrets.GITHUB_TOKEN }}  # Github token'ınızı kullanarak erişim sağlıyoruz

    # 2. Java ve Maven (veya başka test framework'ü) kurulumu
    - name: Set up Java and Maven
      uses: actions/setup-java@v2
      with:
        java-version: '11'  # Java sürümünüzü burada belirtebilirsiniz
        distribution: 'adoptopenjdk'

    # 3. Maven bağımlılıklarını yükleme
    - name: Install Maven Dependencies
      run: mvn clean install  # Maven bağımlılıklarını yükleyin

    # 4. Selenium ve Cucumber testlerini çalıştırma
    - name: Run Selenium and Cucumber Tests
      run: mvn test  # Test framework'ünüzü çalıştıran komut
