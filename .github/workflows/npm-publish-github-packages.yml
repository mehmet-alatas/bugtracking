name: Debug Test Pipeline

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]

jobs:
  debug-test:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout Code
      uses: actions/checkout@v4
    
    # Test 1: Basit Summary OluÅŸturma
    - name: Create Simple Summary
      run: |
        echo "# ðŸ§ª DEBUG TEST SUMMARY" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "Bu bir test summary'sidir." >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "**Tarih:** $(date)" >> $GITHUB_STEP_SUMMARY
        echo "**Branch:** ${{ github.ref_name }}" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "## ðŸ“‹ Test Bilgileri" >> $GITHUB_STEP_SUMMARY
        echo "- âœ… Summary oluÅŸturuldu" >> $GITHUB_STEP_SUMMARY
        echo "- âœ… Artifacts hazÄ±rlandÄ±" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "**ðŸ”— [GitHub Repository](${{ github.server_url }}/${{ github.repository }})**" >> $GITHUB_STEP_SUMMARY
    
    # Test 2: Test DosyalarÄ± OluÅŸturma
    - name: Create Test Files
      run: |
        mkdir -p test-reports
        echo "# Test Raporu" > test-reports/test-summary.md
        echo "" >> test-reports/test-summary.md
        echo "Bu bir test raporu dosyasÄ±dÄ±r." >> test-reports/test-summary.md
        echo "Tarih: $(date)" >> test-reports/test-summary.md
        echo "" >> test-reports/test-summary.md
        echo "## Test SonuÃ§larÄ±" >> test-reports/test-summary.md
        echo "- TÃ¼m testler baÅŸarÄ±lÄ±" >> test-reports/test-summary.md
        
        # Fake Cucumber URL
        echo "https://reports.cucumber.io/reports/fake-test-url-123" > test-reports/cucumber-url.txt
        
        # Test log
        echo "Test log baÅŸlangÄ±cÄ±" > test-reports/test.log
        echo "Maven baÅŸlatÄ±lÄ±yor..." >> test-reports/test.log
        echo "Testler Ã§alÄ±ÅŸÄ±yor..." >> test-reports/test.log
        echo "ðŸ¥’ Cucumber report: https://reports.cucumber.io/reports/fake-test-url-123" >> test-reports/test.log
        echo "Test log sonu" >> test-reports/test.log
        
        # DosyalarÄ± listele
        echo "=== OluÅŸturulan dosyalar ==="
        ls -la test-reports/
        echo "=== Test summary iÃ§eriÄŸi ==="
        cat test-reports/test-summary.md
    
    # Test 3: Artifacts Upload
    - name: Upload Test Artifacts
      uses: actions/upload-artifact@v4
      if: always()
      with:
        name: debug-test-reports
        path: |
          test-reports/
        retention-days: 7
    
    # Test 4: Multiple Artifacts
    - name: Upload Individual Files
      uses: actions/upload-artifact@v4
      if: always()
      with:
        name: cucumber-url-only
        path: test-reports/cucumber-url.txt
        retention-days: 7
    
    # Test 5: Environment Variable Test
    - name: Test Environment Variables
      run: |
        echo "TEST_URL=https://example.com/test-report" >> $GITHUB_ENV
        echo "Environment variable set: TEST_URL"
    
    # Test 6: Use Environment Variable in Summary
    - name: Add Environment Variable to Summary
      run: |
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "## ðŸŒ Environment Test" >> $GITHUB_STEP_SUMMARY
        echo "**Test URL:** ${{ env.TEST_URL }}" >> $GITHUB_STEP_SUMMARY
        echo "**Current Env:** ${TEST_URL:-Not Set}" >> $GITHUB_STEP_SUMMARY
    
    # Test 7: PR Comment (sadece PR'larda)
    - name: Comment on PR
      uses: actions/github-script@v7
      if: github.event_name == 'pull_request'
      with:
        script: |
          const testComment = `# ðŸ§ª DEBUG TEST RESULTS
          
          Bu bir debug test yorumudur.
          
          ## ðŸ“Š Test Bilgileri
          - **Tarih:** ${new Date().toLocaleString()}
          - **Branch:** ${context.ref.replace('refs/heads/', '')}
          - **Workflow:** ${context.workflow}
          
          ## ðŸ“ Artifacts
          - \`debug-test-reports\` - TÃ¼m test dosyalarÄ±
          - \`cucumber-url-only\` - Sadece Cucumber URL
          
          **ðŸ”— [Workflow Run](${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }})**
          `;
          
          github.rest.issues.createComment({
            issue_number: context.issue.number,
            owner: context.repo.owner,
            repo: context.repo.repo,
            body: testComment
          });
    
    # Test 8: Final Summary Addition
    - name: Final Summary Check
      if: always()
      run: |
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "---" >> $GITHUB_STEP_SUMMARY
        echo "## âœ… Debug Test TamamlandÄ±" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "EÄŸer bu summary'yi gÃ¶rebiliyorsanÄ±z, sistem Ã§alÄ±ÅŸÄ±yor demektir!" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "**Artifacts kontrolÃ¼:** SayfanÄ±n en altÄ±na scroll yapÄ±n." >> $GITHUB_STEP_SUMMARY
        
        # Summary iÃ§eriÄŸini de konsola yazdÄ±r
        echo "=== GITHUB_STEP_SUMMARY iÃ§eriÄŸi ==="
        cat $GITHUB_STEP_SUMMARY
